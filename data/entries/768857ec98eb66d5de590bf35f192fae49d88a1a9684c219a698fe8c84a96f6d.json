{"title":"How to setup a Handshake site with Caddy","link":"https://blog.webb.page/2021-05-15-secure-handshake-and-caddy.txt","date":1621036800000,"content":"<p>For the uninitiated, Handshake<a href=\"https://handshake.org\">1</a> is a protocol intended to\nembrace (and ideally extinguish) legacy DNS. If that statement scares you, it\nmakes sense. Drastic change is alarming. Yes, there is a blockchain involved\nbut we're not going to get into that. You came here because\nyou 1) have a Handshake TLD and 2) you have a site you want to use on it.</p>\n<p>Caddy<a href=\"https://caddyserver.com\">2</a>, by default, automatically issues TLS certificates via LetsEncrypt but\nLE is a centralized certificate authority and doesn't know what Handshake is.\nNot to worry, we'll generate our own secure certificates with\nOUR OWN CA (via light-ca<a href=\"https://github.com/light-river/light-ca\">3</a>)! After that we'll update our Caddyfile and\nreload/restart the server to test and finalize our changes. Easy-peasy.</p>\n<p>For this tutorial I'll be using my TLD starbase/. Rather than make the root\ndomain resolve to a site, I'm opting to use an SLD (second-level domain)\ninstead (so, welcome.starbase in this example). You should be familiar with DNS\nand managing servers before continuing. Without further ado, let's begin!</p>\n<ol>\n<li><p>SFTP your site content to your VPS</p>\n</li>\n<li><p>SSH into VPS and install light-ca</p>\n</li>\n</ol>\n<pre><code>curl -sL https://github.com/light-river/light-ca/releases/download/latest/light-ca.tar.gz | tar zx &amp;&amp; sudo mv ./light-ca /usr/bin/light-ca\n</code></pre>\n<ol>\n<li>Create certs</li>\n</ol>\n<pre><code>light-ca --domains \"welcome.starbase\"\n</code></pre>\n<ol>\n<li>Update Caddyfile</li>\n</ol>\n<pre><code>welcome.starbase {\n  # This is the path to a folder on my server that holds the site code\n  root * /var/www/starbase/\n  encode gzip\n  file_server\n  # This is the path to the certs created by light-ca\n  # The paths I chose are not the defaults.\n  # Syntax: tls &lt;path to cert.pem&gt; &lt;path to key.pem&gt;\n  tls /var/custom-certs/welcome.starbase/cert.pem /var/custom-certs/welcome.starbase/key.pem\n}\n</code></pre>\n<ol>\n<li>Reload Caddy and check for issues</li>\n</ol>\n<pre><code>systemctl reload caddy\n# If there are no issues, run next command\nsystemctl restart caddy\n</code></pre>\n<ol>\n<li>Finally, add A record to TLD DNS (via Namebase<a href=\"https://namebase.io\">4</a>) with VPS' IP address.</li>\n</ol>\n<p>I'm assuming you're using NextDNS<a href=\"https://nextdns.io\">5</a>, hDNS<a href=\"https://hdns.io\">6</a>, or some other method of natively\nviewing Handshake domains on your device. If so, enter https:// in\nyour favorite browser to view your \"hard\" work.</p>\n<p>Seriously, this was so easy. ðŸ•¸</p>\n<p>P.S. I'm building a registry AND a registrar for my collection of\nHandshake TLDs. If you want updates on when they launch, follow @neuenet<a href=\"https://twitter.com/neuenet\">7</a> and\n@beachfront_<a href=\"https://twitter.com/beachfront_\">8</a> respectively. The launch is slated for end of summer.</p>\n<hr />\n","author":"","siteTitle":"the webb blog","siteHash":"d87386c8de21b16d23a4d22ceb0991728c5b4e4486d627490c6fcde14e563300","entryHash":"768857ec98eb66d5de590bf35f192fae49d88a1a9684c219a698fe8c84a96f6d","category":"Sites"}