{"title":"Using nginx and Socket.io","link":"https://blog.webb.page/2018-02-09-nginx-and-socketio.txt","date":1518134400000,"content":"<p>When pushing Socii<a href=\"https://hub.socii.network\">1</a> to production, I forgot how to account for the fact that\nSocket.io<a href=\"https://socket.io\">2</a> will not work out of the box with HTTPS without a lil' extra\nconfiguration.</p>\n<p>On your nginx server, you'll want to edit your <code>default</code> file located at <code>etc</code></p>\n<blockquote>\n<p><code>nginx</code> &gt; <code>sites-available</code>. I'll use one of my server blocks as an example:</p>\n</blockquote>\n<pre><code>server {\n  # removed for brevity\n\n  location ~* \\.io {\n    proxy_set_header X-Real-IP        $remote_addr;\n    proxy_set_header X-Forwarded-For  $proxy_add_x_forwarded_for;\n    proxy_set_header Host             $http_host;\n    proxy_set_header X-NginX-Proxy    true;\n    proxy_pass                        http://localhost:1234;\n    proxy_redirect                    off;\n    proxy_http_version                1.1;\n    proxy_set_header Upgrade          $http_upgrade;\n    proxy_set_header Connection       \"upgrade\";\n\n    proxy_redirect                    off;\n    proxy_set_header                  X-Forwarded-Proto $scheme;\n    proxy_cache_key                   sfs$request_uri$scheme;\n  }\n}\n</code></pre>\n<p>The <code>proxy_pass</code> value will be the same as your app's. Actually, the entire\nlocation directive is exactly the same, except for the opening <code>location</code> bit.\nSo, in the section that was removed for brevity you'd have the same <code>location</code>\nblock as above but <code>location ~* \\.io</code> would be replaced with <code>location /</code>.</p>\n<p>Once you're done editing, SSH into your server and run <code>nginx -t</code> to ensure\nyour configuration syntax is solid. Your changes won't be applied until the\nnginx service (or your server) restarts and if you configured something\nincorrectly, you don't want that to happen. If you get a message saying the\nsyntax is okay, run <code>service nginx restart</code> and you're good to go!</p>\n<p>This is something I do once or twice a year and am stumped by so this blog post\nis serving as an external memory unit. Hope this helps you as well! ðŸ•¸</p>\n<hr />\n","author":"","siteTitle":"the webb blog","siteHash":"d87386c8de21b16d23a4d22ceb0991728c5b4e4486d627490c6fcde14e563300","entryHash":"3e031ca6df4e31bb86bb0c48be56c87bf6069b6336b84d4e22941115e056aed3","category":"Sites"}